<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PawTube â€“ Upload</title>

    <meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               script-src 'self' https://www.gstatic.com https://www.googleapis.com 'unsafe-inline';
               connect-src https://firestore.googleapis.com https://www.googleapis.com;
               style-src 'self' 'unsafe-inline';
               img-src 'self' data:;
               frame-src *;">

    <style>
        body {
            font-family: Arial;
            max-width: 700px;
            margin: 40px auto;
        }
        header {
            background: #cc0000;
            padding: 10px 15px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header img {
            height: 34px;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 12px 0;
            font-size: 16px;
        }
        button {
            background: #cc0000;
            color: white;
            border: none;
            padding: 12px 16px;
            font-size: 17px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<header>
    <a href="index.html"><img src="Logo.png" alt="PawTube"></a>
    <div>
        <a href="index.html" style="color:white;margin-right:15px;">Home</a>
        <a href="upload.html" style="color:white;margin-right:15px;">Upload</a>
        <a href="channels.html" style="color:white;">Channels</a>
    </div>
</header>

<h2>Upload Video</h2>
<p>This site only accepts videos via embed codes.</p>

<label>Video Title</label>
<input id="title" type="text">

<label>Description</label>
<textarea id="desc" rows="4"></textarea>

<label>Embed Code (iframe)</label>
<textarea id="embed" rows="4" placeholder='<iframe src="..."></iframe>'></textarea>

<button id="uploadBtn">Publish</button>

<p id="msg"></p>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp }
        from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged }
        from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    // Your config
    const firebaseConfig = {
        apiKey: "AIzaSyBhtICW3CZ3xk2aE-LFUx_hDvmEMMfoHmc",
        authDomain: "old--2005---2012.firebaseapp.com",
        projectId: "old--2005---2012",
        storageBucket: "old--2005---2012.firebasestorage.app",
        messagingSenderId: "151747899362",
        appId: "1:151747899362:web:50517fcdead38e2e57d3bb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const uploadBtn = document.getElementById("uploadBtn");
    const msg = document.getElementById("msg");

    let currentUser = null;

    onAuthStateChanged(auth, user => {
        currentUser = user;
        if (!user) {
            msg.textContent = "You must be logged in to upload.";
            uploadBtn.disabled = true;
        }
    });

    uploadBtn.onclick = async () => {
        const title = document.getElementById("title").value.trim();
        const desc = document.getElementById("desc").value.trim();
        const embed = document.getElementById("embed").value.trim();

        if (!title || !embed) {
            msg.textContent = "Title and embed code are required.";
            return;
        }

        if (!currentUser) {
            msg.textContent = "You must be logged in.";
            return;
        }

        try {
            await addDoc(collection(db, "videos"), {
                title,
                desc,
                embed,
                owner: currentUser.uid,
                timestamp: serverTimestamp()
            });

            msg.textContent = "Uploaded successfully.";
        } catch (err) {
            msg.textContent = "Error: " + err.message;
        }
    };
</script>

</body>
</html>
